 
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
    </style>
    <!--script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyAeqPac68BRWyDN4QSQDVU1RnkrIZVuhvc&libraries=visualization"/-->
    <script src="http://maps.google.com/maps/api/js?sensor=true&libraries=visualization" type="text/javascript"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
    <!--script type="text/javascript" src="jquery-2.1.0.min.js"/-->
    <!--script src="reports.js"></script>
    <script src="events.js"></script-->
    <script type="text/javascript" src="heatmap.js"> </script>
    <script type="text/javascript">

loadScript = function() {
    
    mapCentre = new google.maps.LatLng(18.55, -72.30) //52.953250, -1.187569)

    var mapOptions = {
        zoom: 12,
        center: mapCentre,
        mapTypeId: google.maps.MapTypeId.SATELLITE
    };

    map = new google.maps.Map(document.getElementById('map-canvas'),
        mapOptions);

    overlayOptions = {
        opacity:1,
        map: map,
        clickable: true
    };

    switchOverlay(true);
    //set up timeouts to call loadpeaks periodically
};
$(document).ready(function(){

    mapdatastr = "mapdata/map_test"

    loadScript();
    $("#starter").click(function(){
        $.post("start_heatmap", [], []);
    });

    $("#submit").click(function(){
        var c_val = $("input[name='c_val']:checked").val();
        var type = $("input[name='type']:checked").val();
        var lat = $("#lat").val();
        var lon = $("#lon").val();
        var rep_id = $("input[name='rep_id']:checked").val();
        var reporter = $("#reporter").val();
        var trust_acc = $("#trust_acc").val();
        var trust_var = $("#trust_var").val();

        // Returns successful data submission message when the entered information is stored in database.
        var data = { c_val: c_val, type: type, lat: lat, lon:lon, rep_id:rep_id, reporter:reporter, 
                trust_acc:trust_acc, trust_var:trust_var
        };

        var succ_callback = function(data) {
            $('#crowd_report_form')[0].reset(); //To reset form fields
            //alert("reloading map after update") //don't update now as it will take a while to reload anyway
            //setHeatMapLayer();
            alert("Submitted new report. Map update in progress, please wait for change to take effect...");
        };

        $.post("crowd_reports", data, succ_callback);
    });

//     setTimeout(function(){
//         if (timeoutOverridden>0){
//             timeoutOverridden -= 1;
//             return;
//         }
//         setHeatMapLayer();
//     }, 10000);

});
    </script>
    <title> Crowd Scanner </title>
  </head>
  <body style="background-color:#233462; font-family: sans-serif">
    <div style="height:50px; background:linear-gradient(#304888, #233462); padding-top:10px; color:white">         
        <div style="float:left;padding-left:10px; width:330px"><h2 style="margin:0" id="titletext"> Haiti CrowdScanner</h2></div>
        <div align="center"> <h2 id="titletext" style="margin:0" > <span class="statustext" id="statustext" >Haiti CrowdScanner</span></h2></div>
    </div>
    <div id="panel" style="width: 350px; float: left; background-color:#FFFFFF; border:1px solid #304888; padding-bottom:10px">
        
<!--        <form action="">
            <input type="radio" checked="true" name="layerSelect" value="Emergency" id="emergency">Emergency: medical, trapped/vulnerable people<br>
            <input type="radio" name="layerSelect" value="Vital Lines" id="vital">Vital lines: food, water, power, fuel, shelter<br>
            <input type="radio" name="layerSelect" value="Public Health" id="health">Public Health<br>
            <input type="radio" name="layerSelect" value="Security Threats" id="security">Security threats: looting, violence, riots<br>
            <input type="radio" name="layerSelect" value="Infrastructure" id="infra">Infrastructure Damage: buildings, roads, bridges<br>
            <input type="radio" name="layerSelect" value="Natural Hazards" id="natural">Natural Hazards: after shocks, deaths, missing people, floods, landslides.<br>
            <input type="radio" name="layerSelect" value="Services" id="services">Services Available: hostpicals, food distribution, aid distribution<br>
            <input type="radio" name="layerSelect" value="People" id="people">People: person news, search and rescue operations, displaced people gathering.<br>
        </form>-->
        <div style="float:left;padding-left:10px"><span><h3>Map type</h3></span></div>
        <ul style="list-style-type:none;padding-left:10px">
            <li style="clear:both"><input style="float:left;" type="radio" name="maptype" id="pred" checked="true"><label for="pred" style="float:left;width: 90%;" ><span>Predictions of current situation</span></label></li>
            <li style="clear:both"><input style="float:left;" type="radio" name="maptype" id="unc"><label for="unc" style="float:left;width: 90%;" ><span>Uncertainty in predictions: where we need more reports</span></label></li>
        </ul>
        <div style="float:left;padding-left:10px"><span><h3>Map generation method</h3></span></div>
        <ul style="list-style-type:none;padding-left:10px">
            <li style="clear:both"><input style="float:left;" type="radio" name="method" id="reports" checked="true" ><label for="reports" style="float:left;width: 90%;" ><span>Crowd reports only: no statistical modelling</span></label></li>
            <li style="clear:both"><input style="float:left;" type="radio" name="method" id="bcc"><label for="bcc" style="float:left;width: 90%;" ><span>Bayesian Heatmap: interpolate between reports</span></label></li>
            <li style="clear:both"><input style="float:left;" type="radio" name="method" id="targets"><label for="targets" style="float:left;width: 90%;" ><span>UAV Targets proposed from heatmap</span></label></li>
        </ul>

        <br/>
        <div style="float:left;padding-left:10px;padding-right:5px">
        <div style="float:left;width:330px"><hr>
        <span><h3>Submit a new report</h3></span></div>
        <form action="crowd_reports" method="post" id="crowd_report_form">
            <div style="padding-bottom:5px; padding-top:5px;float:left;width:350px">
            <input type="radio" name="c_val" id="pos" value="1"/>
            <label for="pos"><span>Positive: confirm event/target</span><br/></label>
            <input type="radio" name="c_val" checked="true" id="neg" value="0"/>
            <label for="neg"><span>Negative: no event or target here</span><br/></label>
            </div>

            <div style="padding-bottom:5px; padding-top:5px;float:right">
            <div style="float:left;width:85px; padding-right:10px"><b>Type</b></div>
            <div style="text-align:left;float:right;width:255px; padding-bottom:10px">
            <input type="radio" name="type" checked="true" id="Emergency" value="1"/>
            <label for="Emergency"><span>Emergency</span><br/></label>
            </div>  </div>

            <div style="padding-bottom:5px;padding-top:5px;width:350px;float:right">
            <div style="float:left;width:85px"><b>Location</b></div>
            <div style="text-align:left;float:right;width:255px;height:30px">
            <label for="lat"><span>Lat:</span></label>
            <input style="width:60px" type="number" step="0.001" name="lat" id="lat" value="18.545"/>
            <label for="lon"><span>Lon:</span></label>
            <input style="width:60px" type="number" step="0.001" name="lng" id="lon" value="-72.295"/>
            </div> </div>
                         
            <div style="padding-bottom:5px;padding-top:5px;width:350px;float:right">
            <div style="float:left;width:85px"><b>Reporter ID</b></div>
            <div style="text-align:left;float:right;width:255px;height:40px">
            <input type="radio" name="rep_id" id="rep_id_new" checked="true" value="-1"/><label for="rep_id_new">
            <span>New</span></label>
            </div><div style="text-align:left;float:right;width:255px;height:40px">
            <input type="radio" name="rep_id" id="rep_id_no" value="0"/>
            <label for="rep_id_no"><span>Existing ID</span></label>
            <input type="number" step="1" name="reporter" id="reporter" style="width:40px" value="15"/>
            </div>  </div>

            <div style="padding-bottom:5px;padding-top:5px;width:350px;float:right">
            <div style="float:left;width:85px"><b>Trust</b></div>
            <div style="text-align:left;float:right;width:255px;height:40px">
            <label for="trust_acc">Accuracy: </label>
            <input type="number" style="width:40px" name="trust_acc" id="trust_acc" value="0.8" step="0.01"/>
            </div><div style="text-align:left;float:right;width:255px;height:40px">
            <label for="trust_var">Certainty (precision): </label>
            <input type="number" style="width:40px" name="trust_var" id="trust_var" value="200" step="0.5"/>
            </div> </div>

            <div style="width:350px;float:right;padding-bottom:20px;">
            <input style="width:200px; height:30px" type="button" value="Post New Report" name="submit" id="submit"/>
            </div>

            <div style="float:left;padding-right:10px;width:330px" ><hr>Map file displayed: <span class="filename_disp" id="filename_disp">Map File</span></div>
            
            <div style="float:left; padding-top:10px; padding-bottom:10px"><form action="start_heatmap" method="post" id="starter_form">
                <input style="width:200px; height:30px" type="button" value="Start Gathering Reports" name="starter" id="starter"/>
            </form></div>

        </form></div>
    </div>
    <div style="height:100%">
        <div id="map-canvas"/>
    </div>
  </body>
  <script>
$("input[name='maptype']").change(function(){
    switchOverlay();
});

$("input[name='method']").change(function(){
    switchOverlay();
});
  </script>
</html>